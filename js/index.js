var daata = [
  {
    name: "never alta n2",
    values: [
      { date: "1", price: "78" },
      { date: "2", price: "49" },
      { date: "3", price: "46" },
      { date: "4", price: "46" },
      { date: "5", price: "45" },
      { date: "6", price: "44" },
      { date: "7", price: "44" },
      { date: "8", price: "44" },
      { date: "9", price: "48" },
      { date: "10", price: "50" },
      { date: "11", price: "50" },
      { date: "12", price: "52" },
      { date: "13", price: "52" },
      { date: "14", price: "47" },
      { date: "15", price: "45" },
      { date: "16", price: "42" },
      { date: "17", price: "54" },
      { date: "18", price: "64" },
      { date: "19", price: "43" },
      { date: "20", price: "42" },
      { date: "21", price: "41" },
      { date: "22", price: "60" },
      { date: "23", price: "59" },
      { date: "24", price: "42" }
    ]
  },
  {
    name: "nevera alta n1",
    values: [
      { date: "1", price: "98" },
      { date: "2", price: "96" },
      { date: "3", price: "97" },
      { date: "4", price: "97" },
      { date: "5", price: "96" },
      { date: "6", price: "95" },
      { date: "7", price: "95" },
      { date: "8", price: "51" },
      { date: "9", price: "0" },
      { date: "10", price: "65" },
      { date: "11", price: "97" },
      { date: "12", price: "102" },
      { date: "13", price: "102" },
      { date: "14", price: "124" },
      { date: "15", price: "94" },
      { date: "16", price: "114" },
      { date: "17", price: "98" },
      { date: "18", price: "105" },
      { date: "19", price: "118" },
      { date: "20", price: "90" },
      { date: "21", price: "110" },
      { date: "22", price: "112"},
      { date: "23", price: "89" },
      { date: "24", price: "102" }
    ]
  },
  {
    name: "arcon n4",
    values: [
      { date: "1", price: "0" },
      { date: "2", price: "0" },
      { date: "3", price: "0" },
      { date: "4", price: "0" },
      { date: "5", price: "0" },
      { date: "6", price: "0" },
      { date: "7", price: "0" },
      { date: "8", price: "17" },
      { date: "9", price: "29" },
      { date: "10", price: "28" },
      { date: "11", price: "28" },
      { date: "12", price: "28" },
      { date: "13", price: "28" },
      { date: "14", price: "28" },
      { date: "15", price: "28" },
      { date: "16", price: "29" },
      { date: "17", price: "27" },
      { date: "18", price: "28" },
      { date: "19", price: "28" },
      { date: "20", price: "28" },
      { date: "21", price: "29" },
      { date: "22", price: "27"},
      { date: "23", price: "12" },
      { date: "24", price: "0" }
    ]
  },
  {
    name: "arcon n2 final pasillo",
    values: [
      { date: "1", price: "12" },
      { date: "2", price: "107" },
      { date: "3", price: "108" },
      { date: "4", price: "106" },
      { date: "5", price: "115" },
      { date: "6", price: "167" },
      { date: "7", price: "112" },
      { date: "8", price: "92" },
      { date: "9", price: "163" },
      { date: "10", price: "128" },
      { date: "11", price: "110" },
      { date: "12", price: "141" },
      { date: "13", price: "135" },
      { date: "14", price: "169" },
      { date: "15", price: "134" },
      { date: "16", price: "174" },
      { date: "17", price: "171" },
      { date: "18", price: "167" },
      { date: "19", price: "119" },
      { date: "20", price: "155" },
      { date: "21", price: "119" },
      { date: "22", price: "147"},
      { date: "23", price: "118" },
      { date: "24", price: "107" }
    ]
  },
  {
    name: "arcon n1 final pasillo",
    values: [
      { date: "1", price: "80" },
      { date: "2", price: "91" },
      { date: "3", price: "99" },
      { date: "4", price: "97" },
      { date: "5", price: "85" },
      { date: "6", price: "83" },
      { date: "7", price: "129" },
      { date: "8", price: "128" },
      { date: "9", price: "125" },
      { date: "10", price: "98" },
      { date: "11", price: "115" },
      { date: "12", price: "127" },
      { date: "13", price: "126" },
      { date: "14", price: "85" },
      { date: "15", price: "134" },
      { date: "16", price: "134" },
      { date: "17", price: "130" },
      { date: "18", price: "128" },
      { date: "19", price: "127" },
      { date: "20", price: "126" },
      { date: "21", price: "85" },
      { date: "22", price: "96"},
      { date: "23", price: "114" },
      { date: "24", price: "83" }
    ]
  },
  {
    name: "arcon n3 pasillo",
    values: [
      { date: "1", price: "124" },
      { date: "2", price: "124" },
      { date: "3", price: "125" },
      { date: "4", price: "124" },
      { date: "5", price: "125" },
      { date: "6", price: "124"},
      { date: "7", price: "124" },
      { date: "8", price: "125" },
      { date: "9", price: "124" },
      { date: "10", price: "125"},
      { date: "11", price: "132" },
      { date: "12", price: "126" },
      { date: "13", price: "125" },
      { date: "14", price: "166"},
      { date: "15", price: "127" },
      { date: "16", price: "163" },
      { date: "17", price: "128" },
      { date: "18", price: "128" },
      { date: "19", price: "169" },
      { date: "20", price: "124" },
      { date: "21", price: "160"},
      { date: "22", price: "134"},
      { date: "23", price: "126" },
      { date: "24", price: "125" }
    ]
  }
];
var data2=[
  {
    name: "nevera alta n1/ arcon n2 final pasillo",
    values: [
      { date: "1", price: "0" },
      { date: "2", price: "0" },
      { date: "3", price: "0" },
      { date: "4", price: "0" },
      { date: "5", price: "0" },
      { date: "6", price: "0"},
      { date: "7", price: "0" },
      { date: "8", price: "0" },
      { date: "9", price: "0" },
      { date: "10", price: "1"},
      { date: "11", price: "3" },
      { date: "12", price: "2" },
      { date: "13", price: "4" },
      { date: "14", price: "8"},
      { date: "15", price: "8" },
      { date: "16", price: "5" },
      { date: "17", price: "1" },
      { date: "18", price: "0" },
      { date: "19", price: "2" },
      { date: "20", price: "0" },
      { date: "21", price: "0"},
      { date: "22", price: "0"},
      { date: "23", price: "0" },
      { date: "24", price: "0" }
    ]
  },
  {
    name: "nevera_alta_1/ arcon n2 final pasillo",
    values: [
      { date: "1", price: "0" },
      { date: "2", price: "0" },
      { date: "3", price: "0" },
      { date: "4", price: "0" },
      { date: "5", price: "0" },
      { date: "6", price: "0"},
      { date: "7", price: "0" },
      { date: "8", price: "0" },
      { date: "9", price: "0" },
      { date: "10", price: "0"},
      { date: "11", price: "0" },
      { date: "12", price: "1" },
      { date: "13", price: "1" },
      { date: "14", price: "2"},
      { date: "15", price: "2" },
      { date: "16", price: "3" },
      { date: "17", price: "3" },
      { date: "18", price: "3" },
      { date: "19", price: "3" },
      { date: "20", price: "1" },
      { date: "21", price: "2"},
      { date: "22", price: "2"},
      { date: "23", price: "3" },
      { date: "24", price: "0" }
    ]
  }
]

var width = 800;
var height = 400;
var margin = 90;
var duration = 250;

var lineOpacity = "0.25";
var lineOpacityHover = "0.85";
var otherLinesOpacityHover = "0.1";
var lineStroke = "1.5px";
var lineStrokeHover = "2.5px";

var circleOpacity = '0.85';
var circleOpacityOnLineHover = "0.25"
var circleRadius = 3;
var circleRadiusHover = 6;


/* Format Data */
var parseDate = d3.timeParse("%H");
daata.forEach(function(d) {
  d.values.forEach(function(d) {
    d.date = parseDate(d.date);
  });
});
data2.forEach(function(d) {
  d.values.forEach(function(d) {
    d.date = parseDate(d.date);
    d.price = +d.price;
  });
});


/* Scale */
var xScale = d3.scaleTime()
  .domain(d3.extent(daata[0].values, d => d.date))
  .range([0, width-margin]);

var yScale = d3.scaleLinear()
  .domain([0, 225])
  .range([height-margin, 0]);
var nyScale =  d3.scaleLinear()
  .domain([0, d3.max(data2[0].values, d => d.price)])
  .range([height-margin, 0]);
var color = d3.scaleOrdinal(d3.schemeCategory10);

/* Add SVG */
var svg = d3.select("#chart").append("svg")
  .attr("width", (width+margin)+"px")
  .attr("height", (height+margin)+"px")
  .append('g')
  .attr("transform", `translate(${margin}, ${margin})`);


/* Add line into SVG */
var line = d3.line()
  .x(d => xScale(d.date))
  .y(d => yScale(d.price))
var line2 =d3.line()
  .x(d=>xScale(d.date))
  .y(d=> nyScale(d.price))
let lines = svg.append('g')
  .attr('class', 'lines');
  /*
  -----------------------------------
GROUP 2 SELECT
--------------------------------------
  */
lines.selectAll('.line-group2')
    .data(data2).enter()
    .append('g')
    .attr('class', 'line-group2')
    .on("mouseover", function(d, i) {
        svg.append("text")
          .attr("class", "title-text")
          .style("fill", color(i))
          .text(d.name)
          .attr("text-anchor", "middle")
          .attr("x", (width-margin)/2)
          .attr("y", 5);
      })
    .on("mouseout", function(d) {
        svg.select(".title-text").remove();
      })

    .append('path')
    .attr("width","px")
    .attr('class', 'line')
    .attr('d', d => line2(d.values))
    .style('stroke', (d, i) => color(i))
    .style('opacity', lineOpacity)
    .style('fill',(d, i) => color(i))
    .on("mouseover", function(d) {
        d3.selectAll('.line')
  					.style('opacity', otherLinesOpacityHover);
        d3.selectAll('.circle')
  					.style('opacity', circleOpacityOnLineHover);
        d3.select(this)
          .style('opacity', lineOpacityHover)
          .style("stroke-width", lineStrokeHover)
          .style("cursor", "pointer");
      })
    .on("mouseout", function(d) {
        d3.selectAll(".line")
  					.style('opacity', lineOpacity);
        d3.selectAll('.circle')
  					.style('opacity', circleOpacity);
        d3.select(this)
          .style("stroke-width", lineStroke)
          .style("cursor", "none");
      });

    /*
----------------------------------------
    GROUP1 SELECT
-----------------------------------------
    */
lines.selectAll('.line-group')
  .data(daata).enter()
  .append('g')
  .attr('class', 'line-group')
  .on("mouseover", function(d, i) {
      svg.append("text")
        .attr("class", "title-text")
        .style("fill", color(i))
        .text(d.name)
        .attr("text-anchor", "middle")
        .attr("x", (width-margin)/2)
        .attr("y", 5);
    })
  .on("mouseout", function(d) {
      svg.select(".title-text").remove();
    })
  .append('path')
  .attr('class', 'line')
  .attr('d', d => line(d.values))
  .style('stroke', (d, i) => color(i))
  .style('opacity', lineOpacity)
  .on("mouseover", function(d) {
      d3.selectAll('.line')
					.style('opacity', otherLinesOpacityHover);
      d3.selectAll('.circle')
					.style('opacity', circleOpacityOnLineHover);
      d3.select(this)
        .style('opacity', lineOpacityHover)
        .style("stroke-width", lineStrokeHover)
        .style("cursor", "pointer");
    })
  .on("mouseout", function(d) {
      d3.selectAll(".line")
					.style('opacity', lineOpacity);
      d3.selectAll('.circle')
					.style('opacity', circleOpacity);
      d3.select(this)
        .style("stroke-width", lineStroke)
        .style("cursor", "none");
    });


/* Add circles in the line */
lines.selectAll("circle-group")
  .data(daata).enter()
  .append("g")
  .style("fill", (d, i) => color(i))
  .selectAll("circle")
  .data(d => d.values).enter()
  .append("g")
  .attr("class", "circle")
  .on("mouseover", function(d) {
      d3.select(this)
        .style("cursor", "pointer")
        .append("text")
        .attr("class", "text")
        .text(`${d.price}`)
        .attr("x", d => xScale(d.date) + 5)
        .attr("y", d => yScale(d.price) - 10);
    })
  .on("mouseout", function(d) {
      d3.select(this)
        .style("cursor", "none")
        .transition()
        .duration(duration)
        .selectAll(".text").remove();
    })
  .append("circle")
  .attr("cx", d => xScale(d.date))
  .attr("cy", d => yScale(d.price))
  .attr("r", circleRadius)
  .style('opacity', circleOpacity)
  .on("mouseover", function(d) {
        d3.select(this)
          .transition()
          .duration(duration)
          .attr("r", circleRadiusHover);
      })
    .on("mouseout", function(d) {
        d3.select(this)
          .transition()
          .duration(duration)
          .attr("r", circleRadius);
      });


/* Add Axis into SVG */
var xAxis = d3.axisBottom(xScale).ticks(24);
var yAxis = d3.axisLeft(yScale).ticks(25);
var nyAxis =d3.axisRight(nyScale).ticks(8);
svg.append("g")
  .attr("class", "x axis")
  .attr("transform", `translate(0, ${height-margin})`)
  .call(xAxis);

svg.append("g")
  .attr("class", "y axis")
  .call(yAxis)
  .append('text')
  .attr("y", 15)
  .attr("transform", "rotate(-90)")
  .attr("fill", "#000")
  .text("Wh");
svg.append("g")
    .attr("class", "y axis")
    .attr("transform","translate("+720+",0)")
    .call(nyAxis)
    .append('text')
    .attr("y", 15)
    .attr("fill", "#000")
    .text("Mediciones");

    var divToolTip = d3.select("body").append("div")
                .attr("class", "tooltip")
                .style("opacity", 1e-6);

    function mouseover() {
        divToolTip.transition()
            .duration(700)
            .style("opacity", 1);
    }
    function mouseout() {
        divToolTip.transition()
            .duration(500)
            .style("opacity", 1e-6);
    }

    /*
    ----------------------------------------
    */

    var legendRectSize = 18;                                  // NEW
           var legendSpacing = 4;
    var legend = d3.select('svg')
    var legend = svg.selectAll('.legend')                     // NEW
              .data(color.domain())                                   // NEW
              .enter()                                                // NEW
              .append('g')                                            // NEW
              .attr('class', 'legend')                                // NEW
              .attr('transform', function(d, i) {                     // NEW
                var height = legendRectSize + legendSpacing;          // NEW
                var offset =  height * color.domain().length / 2;     // NEW
                var horz = -2 * legendRectSize;                       // NEW
                var vert = Math.floor(i/3) * height - offset;                       // NEW
                return 'translate(' + i%3 *80 + ',' +Math.floor(i/3) * 22 + ')';        // NEW
              });                                                     // NEW

            legend.append('rect')                                     // NEW
              .attr('width', legendRectSize)                          // NEW
              .attr('height', legendRectSize)                         // NEW
              .style('fill', color)                                   // NEW
              .style('stroke', color);                                // NEW

            legend.append('text')                                     // NEW
              .attr('x', legendRectSize + legendSpacing)              // NEW
              .attr('y', legendRectSize - legendSpacing)              // NEW
              .text(function(d) { console.log(d.value);return (d.value); });
